generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ProposalVote {
  id            String   @id @default(uuid())
  marketAddress String
  userId        String
  vote          String
  timestamp     DateTime @default(now())

  @@unique([marketAddress, userId])
  @@index([marketAddress])
  @@index([userId])
  @@index([marketAddress], map: "idx_proposalevote_market")
}

model ResolutionVote {
  id            String   @id @default(uuid())
  marketAddress String
  userId        String
  vote          String
  comment       String
  timestamp     DateTime @default(now())

  @@unique([marketAddress, userId])
  @@index([marketAddress])
  @@index([userId])
  @@index([marketAddress], map: "idx_resolutionvote_market")
}

model Comment {
  id            String   @id @default(uuid())
  marketAddress String
  userId        String
  comment       String
  upvotes       Int      @default(0)
  downvotes     Int      @default(0)
  type          String   @default("general")
  timestamp     DateTime @default(now())

  @@index([marketAddress])
  @@index([userId])
  @@index([timestamp])
  @@index([marketAddress], map: "idx_comment_market")
}

model CommentVote {
  id        String   @id @default(uuid())
  commentId String
  userId    String
  vote      String
  timestamp DateTime @default(now())

  @@unique([commentId, userId])
  @@index([commentId])
  @@index([commentId], map: "idx_commentvote_comment")
}

model MarketMetadata {
  id          String   @id
  question    String
  description String?
  creator     String
  state       Int
  expiryTime  BigInt
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([state])
  @@index([creator])
  @@index([creator], map: "idx_marketmetadata_creator")
  @@index([state], map: "idx_marketmetadata_state")
}

model UserActivity {
  id            String   @id @default(uuid())
  userId        String
  activityType  String
  marketAddress String
  timestamp     DateTime @default(now())

  @@index([userId])
  @@index([marketAddress])
  @@index([timestamp])
}

model IndexedEvent {
  id              String   @id @default(uuid())
  eventType       String
  marketAddress   String?
  blockNumber     BigInt
  transactionHash String
  logIndex        Int
  eventData       Json
  processed       Boolean  @default(false)
  timestamp       DateTime @default(now())

  @@unique([transactionHash, logIndex])
  @@index([marketAddress])
  @@index([blockNumber])
  @@index([eventType])
  @@index([processed])
  @@index([timestamp])
  @@index([eventType], map: "idx_indexedevent_eventtype")
  @@index([marketAddress], map: "idx_indexedevent_marketaddress")
  @@index([processed], map: "idx_indexedevent_processed")
}
