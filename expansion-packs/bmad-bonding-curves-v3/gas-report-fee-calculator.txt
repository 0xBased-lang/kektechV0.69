
> bmad-bonding-curves-v3@3.0.0 test
> hardhat test

WARNING: You are currently using Node.js v23.11.0, which is not supported by Hardhat. This can lead to unexpected behavior. See https://v2.hardhat.org/nodejs-versions



  DualCurveMath Library
    Price Invariant
      âœ” Should maintain P(YES) + P(NO) = PRECISION with equal supplies (1ms)
      âœ” Should maintain invariant with zero YES supply (0ms)
      âœ” Should maintain invariant with zero NO supply (1ms)
      âœ” Should maintain invariant with large supplies (1ms)
      âœ” Should maintain invariant with very small supplies (0ms)
      âœ” Should revert with zero total supply (division by zero) (5ms)
    Price Calculations
      âœ” Should return 50/50 prices with equal supplies (0ms)
      âœ” Should increase YES price when NO supply is higher (1ms)
      âœ” Should increase NO price when YES supply is higher (0ms)
      âœ” Should handle extreme ratios correctly (0ms)
      âœ” Should getPrice return correct individual price (1ms)
    Buy Calculations
      âœ” Should calculate shares for small ETH amount (0ms)
      âœ” Should calculate fewer shares for large trades (price impact) (1ms)
      âœ” Should revert with zero ETH amount (1ms)
      âœ” Should handle very small ETH amounts (0ms)
    Sell Calculations
      âœ” Should calculate payout for selling shares (0ms)
      âœ” Should revert when selling more shares than supply (1ms)
      âœ” Should revert with zero shares (1ms)
      âœ” Should never exceed reserve amount (0ms)
      âœ” Should apply price impact on large sells (1ms)
    Price Impact
      âœ” Should return zero impact for tiny trades (0ms)
      âœ” Should increase impact with trade size (0ms)
      âœ” Should cap impact at MAX_PRICE_IMPACT (500) (1ms)
      âœ” Should return zero with zero total supply (0ms)
    Invariant Verification
      âœ” Should verify valid invariant (0ms)
      âœ” Should accept 1 wei tolerance (1ms)
      âœ” Should reject invalid invariant (0ms)
    Helper Functions
      âœ” Should calculate TVL correctly (0ms)
      âœ” Should handle zero reserves in TVL (0ms)
    Integration Scenarios
      âœ” Should maintain invariant through buy/sell cycle (1ms)
      âœ” Should handle extreme market conditions (0ms)

  FeeCalculator Library
    Tier 1: Bond-Based Fee Scaling
      âœ” Should return minimum fee for minimum bond (10 BASED) (0ms)
      âœ” Should return maximum fee for maximum bond (1000 BASED) (1ms)
      âœ” Should linearly scale fee for mid-range bond (500 BASED) (0ms)
      âœ” Should linearly scale fee for lower mid-range bond (100 BASED) (0ms)
      âœ” Should linearly scale fee for upper mid-range bond (750 BASED) (0ms)
      âœ” Should revert if bond amount below minimum (1ms)
      âœ” Should revert if bond amount above maximum (0ms)
      âœ” Should handle bond exactly at boundaries (MIN_BOND) (1ms)
      âœ” Should handle bond exactly at boundaries (MAX_BOND) (0ms)
      âœ” Should maintain monotonic increase (larger bond = higher fee) (0ms)
    Tier 2: Voluntary Fee-Based Bonus Scaling
      âœ” Should return zero bonus for zero voluntary fee (0ms)
      âœ” Should return maximum bonus for maximum voluntary fee (1000 BASED) (0ms)
      âœ” Should linearly scale bonus for mid-range voluntary fee (500 BASED) (0ms)
      âœ” Should linearly scale bonus for lower range (250 BASED) (0ms)
      âœ” Should linearly scale bonus for upper range (750 BASED) (0ms)
      âœ” Should revert if voluntary fee above maximum (0ms)
      âœ” Should handle voluntary fee exactly at maximum (1ms)
      âœ” Should maintain monotonic increase (larger voluntary = higher bonus) (0ms)
    Combined Fee Calculation (Additive Model)
      âœ” Should add bond fee + voluntary bonus (minimum case) (1ms)
      âœ” Should add bond fee + voluntary bonus (mid-range case) (0ms)
      âœ” Should add bond fee + voluntary bonus (maximum case) (0ms)
      âœ” Should work with bond only (no voluntary fee) (1ms)
      âœ” Should enforce global trading fee cap (MAX_TRADING_FEE_BPS) (0ms)
      âœ” Should revert if bond amount invalid (1ms)
      âœ” Should revert if voluntary amount invalid (1ms)
      âœ” Should maintain additive property (fee1 + fee2 = total) (1ms)
    3-Way Distribution Validation
      âœ” Should accept valid distribution (33/34/33) (0ms)
      âœ” Should accept valid distribution (30/40/30) (0ms)
      âœ” Should accept valid distribution (25/50/25) (1ms)
      âœ” Should accept valid distribution (20/60/20) (0ms)
      âœ” Should accept edge case (100/0/0) (0ms)
      âœ” Should accept edge case (0/100/0) (0ms)
      âœ” Should accept edge case (0/0/100) (1ms)
      âœ” Should revert if distribution sums to less than 100% (0ms)
      âœ” Should revert if distribution sums to more than 100% (1ms)
      âœ” Should validate all three shares are within bounds (0ms)
    Fee Splitting (3-Way Distribution)
      âœ” Should correctly split fee with 30/40/30 distribution (0ms)
      âœ” Should correctly split fee with 25/50/25 distribution (1ms)
      âœ” Should correctly split fee with 20/60/20 distribution (0ms)
      âœ” Should revert if total fee is zero (1ms)
    Helper Functions
      âœ” Should correctly calculate voluntary fee tax (10%) (0ms)
      âœ” Should return zero for zero voluntary fee (tax helper) (0ms)
      âœ” Should return complete fee breakdown with all components (1ms)
      âœ” Should revert in getFeeBreakdown if distribution invalid (0ms)
    Constants Verification
      âœ” Should expose correct PRECISION constant (1ms)
      âœ” Should expose correct bond range constants (0ms)
      âœ” Should expose correct bond fee range constants (0ms)
      âœ” Should expose correct voluntary fee range constants (1ms)
      âœ” Should expose correct voluntary bonus range constants (0ms)
      âœ” Should expose correct voluntary fee tax constant (0ms)
      âœ” Should expose correct trading fee cap constant (0ms)

Â·------------------------|---------------------------|-------------|-----------------------------Â·
|  [90mSolc version: 0.8.20[39m  Â·  [90mOptimizer enabled: true[39m  Â·  [90mRuns: 200[39m  Â·  [90mBlock limit: 30000000 gas[39m  â”‚
Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·
|  [32m[1mMethods[22m[39m                                                                                       â”‚
Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·
|  [1mContract[22m   Â·  [1mMethod[22m  Â·  [32mMin[39m        Â·  [32mMax[39m        Â·  [32mAvg[39m        Â·  [1m# calls[22m      Â·  [1musd (avg)[22m  â”‚
Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·
|  [32m[1mDeployments[22m[39m           Â·                                         Â·  [1m% of limit[22m   Â·             â”‚
Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·
|  DualCurveMathTester   Â·          -  Â·          -  Â·     463240  Â·        [90m1.5 %[39m  Â·          [32m[90m-[32m[39m  â”‚
Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·|Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·
|  FeeCalculatorTester   Â·          -  Â·          -  Â·     556179  Â·        [90m1.9 %[39m  Â·          [32m[90m-[32m[39m  â”‚
Â·------------------------|-------------|-------------|-------------|---------------|-------------Â·

  82 passing (232ms)

